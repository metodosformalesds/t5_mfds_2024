{% extends "base.html" %}
{% load static %}
{% block title %}Pago Reservación - Echérari Tours{% endblock title %}

{% block extra_styles %}
<link rel="stylesheet" href="{% static 'appPayment/css/pago_reservacion.css' %}">
{% endblock extra_styles %}

{% block content %}

<div class="container mt-5">
    <div class="d-flex justify-content-center mb-4">
        <ul class="progressbar">
            <li class="active">
                <span class="circle"></span>
                <p>Detalles de reservación</p>
            </li>
            <li class="active">
                <span class="circle"></span>
                <p>Pago</p>
            </li>
            <li>
                <span class="circle"></span>
                <p>Finalización</p>
            </li>
        </ul>
    </div>

    <div class="row">
        <div class="col-md-6">
            <h5>Selección de método de pago</h5>

            <!-- Opciones de metodo de pago -->
            <div class="form-check mb-3">
                <input class="form-check-input" type="radio" name="payment_method" id="paypal" value="paypal" checked>
                <label class="form-check-label" for="paypal">
                    PayPal &nbsp; 
                    <span class="text-muted">Serás redirigido al sitio web de PayPal después de enviar tu pedido.</span>
                </label>
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="radio" name="payment_method" id="credit_card" value="credit_card">
                <label class="form-check-label" for="credit_card">
                    Pago con tarjeta
                    <div class="d-flex payment-icons mt-1">
                        <img src="{% static 'appPayment/img/visa.png' %}" alt="Visa" class="payment-icon">
                        <img src="{% static 'appPayment/img/discover.png' %}" alt="Discover" class="payment-icon">
                        <img src="{% static 'appPayment/img/mastercard.png' %}" alt="Mastercard" class="payment-icon">
                        <img src="{% static 'appPayment/img/mastercard2.png' %}" alt="Mastercard 2" class="payment-icon">
                    </div>
                </label>
            </div>

            <!-- Contenedores de formularios que se alternan -->
            <div id="paypal-info" class="payment-info">
                <p class="text-muted">Serás redirigido al sitio de PayPal al hacer clic en "Realizar pago".</p>
            </div>

            <div id="credit-card-form" class="payment-info" style="display: none;">
                <div class="row bg-light p-3 rounded-3">
                    <div class="col-12 mb-3">
                        <label for="cardholder_name">Nombre completo del dueño de la tarjeta</label>
                        <input type="text" class="form-control" id="cardholder_name" placeholder="Rodrigo Fierro">
                    </div>
                    <div class="col-12 mb-3">
                        <label for="card_number">Número de tarjeta</label>
                        <input type="text" class="form-control" id="card_number" placeholder="1234 5678 9012 3456">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="expiration_date">Fecha de expiración</label>
                        <input type="text" class="form-control" id="expiration_date" placeholder="MM/YY">
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="cvv">CVV</label>
                        <input type="text" class="form-control" id="cvv" placeholder="123">
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumen de la reservacion -->
        <div class="col-md-5 offset-md-1">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Resumen de la compra</h5>
                    <div class="d-flex">
                        <img src="{{ tour.image_url }}" class="img-thumbnail me-3" alt="{{ tour.title }}" style="width: 100px;">
                        <div>
                            <p class="fw-bold">{{ tour.title }}</p>
                            <p><i class="bi bi-calendar"></i> {{ tour.start_date|date:"d \\d\\e F \\d\\e\\l Y" }}</p>
                        </div>
                    </div>
                    <hr>
                    <h5 class="fw-bold">Precio Total <span class="text-success">${{ total_price }}</span></h5>
                    <p>Número de personas: {{ number_people }}</p>
                    <form action="{% url 'pago_reservacion' tour_id=tour.id %}" method="post">
<form action="{% url 'pago_reservacion' tour_id=tour.id %}" method="post">
    {% csrf_token %}
    
    <div class="form-check mb-3">
        <input class="form-check-input" type="radio" name="payment_method" id="paypal" value="paypal" checked>
        <label class="form-check-label" for="paypal">
            PayPal &nbsp; 
            <span class="text-muted">Serás redirigido al sitio web de PayPal después de enviar tu pedido.</span>
        </label>
    </div>

    <div class="form-check mb-3">
        <input class="form-check-input" type="radio" name="payment_method" id="credit_card" value="credit_card">
        <label class="form-check-label" for="credit_card">
            Pago con tarjeta
            <div class="d-flex payment-icons mt-1">
                <img src="{% static 'appPayment/img/visa.png' %}" alt="Visa" class="payment-icon">
                <img src="{% static 'appPayment/img/discover.png' %}" alt="Discover" class="payment-icon">
                <img src="{% static 'appPayment/img/mastercard.png' %}" alt="Mastercard" class="payment-icon">
                <img src="{% static 'appPayment/img/mastercard2.png' %}" alt="Mastercard 2" class="payment-icon">
            </div>
        </label>
    </div>
    
    <input type="hidden" name="number_people" value="{{ number_people }}">
    <button type="submit" class="btn btn-success">Procesar pago</button>
</form>
                    
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const paypalOption = document.getElementById('paypal');
        const creditCardOption = document.getElementById('credit_card');
        const paypalInfo = document.getElementById('paypal-info');
        const creditCardForm = document.getElementById('credit-card-form');

        // Funcion para mostrar el formulario 
        function togglePaymentInfo() {
            if (paypalOption.checked) {
                paypalInfo.style.display = 'block';
                creditCardForm.style.display = 'none';
            } else if (creditCardOption.checked) {
                paypalInfo.style.display = 'none';
                creditCardForm.style.display = 'block';
            }
        }

        paypalOption.addEventListener('change', togglePaymentInfo);
        creditCardOption.addEventListener('change', togglePaymentInfo);

        togglePaymentInfo();
    });
</script>

{% endblock content %}